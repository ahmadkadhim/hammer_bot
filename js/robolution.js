// Generated by CoffeeScript 1.6.3
(function() {
  $(document).ready(function() {
    var AjaxRequest, Controller, Dance, drawClown, human, keyMap, moonwalk, server;
    $(".controller").hide();
    keyMap = {
      37: {
        direction: {
          strafe: +1
        },
        id: "left"
      },
      38: {
        direction: {
          forward: +1
        },
        id: "up"
      },
      39: {
        direction: {
          strafe: -1
        },
        id: "right"
      },
      40: {
        direction: {
          forward: -1
        },
        id: "down"
      }
    };
    Controller = (function() {
      function Controller() {}

      $(document).keydown(function(e) {
        var direction, pressed;
        pressed = keyMap[e.keyCode];
        direction = {};
        $("#" + keyMap[e.keyCode].id).addClass("selected");
        return server.get(keyMap[e.keyCode].direction);
      });

      $(document).keyup(function(e) {
        return $("#" + keyMap[e.keyCode].id).removeClass("selected");
      });

      return Controller;

    })();
    AjaxRequest = (function() {
      function AjaxRequest() {}

      AjaxRequest.prototype.get = function(input) {
        return $.ajax("http://127.0.0.1:8071/motion-control/update", {
          data: input,
          dataType: "jsonp"
        });
      };

      return AjaxRequest;

    })();
    $("#moonwalk").click(function() {
      $(".button").removeClass("button-choice");
      $(this).addClass("button-choice");
      $(".controller").fadeOut(400);
      $(".canvas-frame").fadeIn(400);
      return moonwalk.start(5000);
    });
    $("#controls").click(function() {
      $(".button").removeClass("button-choice");
      $(this).addClass("button-choice");
      $(".canvas-frame").fadeOut(400);
      return $(".controller").fadeIn(400);
    });
    Dance = (function() {
      var moves;

      function Dance() {}

      moves = [37, 38, 39, 40];

      Dance.prototype.start = function(duration) {
        var keep_dancing, start_time;
        start_time = Date.now();
        return keep_dancing = setInterval(function() {
          var current_move, now_time;
          now_time = Date.now();
          current_move = moves[Math.floor(Math.random() * moves.length)];
          if (start_time + duration <= now_time) {
            console.log("time's up");
            clearInterval(keep_dancing);
          }
          console.log("start time: " + start_time + ", now time: " + now_time);
          console.log("time left: " + (((start_time + duration) - now_time) / 1000));
          return server.get(keyMap[current_move].direction);
        }, 1000);
      };

      Dance.prototype.stopDancing = function() {
        return clearInterval(keep_dancing);
      };

      return Dance;

    })();
    moonwalk = new Dance;
    human = new Controller;
    server = new AjaxRequest;
    drawClown = function() {
      var canvas1, clown, clown_loc, ctx1, rotateImage, torso_x, torso_y;
      canvas1 = document.getElementById('canvas1');
      ctx1 = canvas1.getContext("2d");
      torso_x = (canvas1.width - 256) / 2;
      torso_y = (canvas1.height - 200) / 2;
      clown_loc = {
        source: "../hammer_bot/assets/spritesheet.png",
        torso: {
          width: 100,
          height: 103,
          position: {
            x: 430,
            y: 50
          }
        },
        head: {
          width: 115,
          height: 93,
          position: {
            x: -50,
            y: -242
          }
        },
        r_arm: {
          width: 80,
          height: 92,
          position: {
            x: 250,
            y: 50
          }
        },
        l_arm: {
          width: 100,
          height: 81,
          position: {
            x: 50,
            y: 50
          }
        }
      };
      clown = new Image();
      clown.src = clown_loc.source;
      clown.onload = function(sprite) {
        var angle;
        ctx1.drawImage(clown, clown_loc.torso.position.x, clown_loc.torso.position.y, clown_loc.torso.width, clown_loc.torso.height, torso_x, torso_y, clown_loc.torso.width, clown_loc.torso.height);
        ctx1.drawImage(clown, clown_loc.head.position.x, clown_loc.head.position.y, clown_loc.head.width, clown_loc.head.height, torso_x, torso_y, clown_loc.head.width, clown_loc.head.height);
        ctx1.drawImage(clown, clown_loc.r_arm.position.x, clown_loc.r_arm.position.y, clown_loc.r_arm.width, clown_loc.r_arm.height, torso_x, torso_y, clown_loc.r_arm.width, clown_loc.r_arm.height);
        ctx1.drawImage(clown, clown_loc.l_arm.position.x, clown_loc.l_arm.position.y, clown_loc.l_arm.width, clown_loc.l_arm.height, torso_x, torso_y, clown_loc.l_arm.width, clown_loc.l_arm.height);
        angle = 0;
        return setInterval(function() {
          torso_x = Math.floor(Math.random() * (canvas1.width - 256));
          torso_y = Math.floor(Math.random() * (canvas1.width - 200));
          canvas1.width = canvas1.width;
          ctx1.drawImage(torso, torso_x, torso_y);
          angle += 20;
          rotateImage(head, torso_x - 12, torso_y - 56, head.width, head.height, angle);
          rotateImage(r_arm, torso_x + 81, torso_y - 27, r_arm.width, r_arm.height, angle);
          return rotateImage(l_arm, torso_x - 80, torso_y - 4, l_arm.width, l_arm.height, angle);
        }, 300);
      };
      return rotateImage = function(img, x, y, width, height, deg) {
        var rad;
        rad = (deg * Math.PI) / 180;
        ctx1.translate(x + width / 2, y + height / 2);
        ctx1.rotate(rad);
        ctx1.drawImage(img, width / 2 * (-1), height / 2 * (-1), width, height);
        ctx1.rotate(rad * (-1));
        return ctx1.translate((x + width / 2) * (-1), (y + height / 2) * (-1));
      };
    };
    return drawClown();
  });

}).call(this);
